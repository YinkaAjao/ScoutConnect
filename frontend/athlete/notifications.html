<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications | ScoutConnect</title>
    <link rel="shortcut icon" href="./images/sc-logo.png" type="image/png">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/frontend/tailwind/tailwind.css">
</head>

<body class="bg-gray-100 dark:bg-dark-main">
    <!-- NAV -->
    <nav
        class="bg-white dark:bg-dark-second h-max md:h-14 w-full shadow flex flex-col md:flex-row items-center justify-center md:justify-between fixed top-0 z-50 border-b dark:border-dark-third">

        <!-- LEFT NAV -->
        <div class="flex items-center justify-between w-full md:w-max px-4 py-2">
            <a href="#" class="mr-2 hidden md:inline-block">
                <img src="./images/sc-logo.png" alt="ScoutConnect logo" class="w-24 sm:w-20 lg:w-10 h-auto">
            </a>
            <a href="#" class="inline-block md:hidden">
                <img src="./images/sc-logo-mb.png" alt="" class="w-32 h-auto">
            </a>
            <div class="flex items-center justify-between space-x-1">
                <div
                    class="relative bg-gray-100 dark:bg-dark-third px-2 py-2 w-10 h-10 sm:w-11 sm:h-11 lg:h-10 lg:w-10 xl:w-max xl:pl-3 xl:pr-8 rounded-full flex items-center justify-center cursor-pointer">
                    <i class='bx bx-search-alt-2 text-xl xl:mr-2 dark:text-dark-txt'></i>
                    <input type="text" placeholder="Search notifications..."
                        class="outline-none bg-transparent hidden xl:inline-block">
                </div>
                <div
                    class="text-2xl grid place-items-center md:hidden bg-gray-200 dark:bg-dark-third rounded-full w-10 h-10 cursor-pointer hover:bg-gray-300 dark:text-dark-txt">
                    <i class='bx bx-message-rounded'></i>
                </div>
                <div class="text-2xl grid place-items-center md:hidden bg-gray-200 dark:bg-dark-third rounded-full w-10 h-10 cursor-pointer hover:bg-gray-300 dark:text-dark-txt"
                    id="dark-mode-toggle-mb">
                    <i class='bx bxs-moon'></i>
                </div>
            </div>
        </div>
        <!-- END LEFT NAV -->

        <!-- MAIN NAV -->
        <ul class="flex w-full lg:w-max items-center justify-center">
            <li class="w-1/5 md:w-max text-center">
                <a href="athletedashboard.html"
                    class="w-full text-3xl py-2 px-3 xl:px-12 cursor-pointer text-center inline-block rounded text-gray-600 hover:bg-gray-100 dark:hover:bg-dark-third dark:text-dark-txt">
                    <i class='bx bxs-home'></i>
                </a>
            </li>
            <li class="w-1/5 md:w-max text-center">
                <a href="achievements.html"
                    class="w-full text-3xl py-2 px-3 xl:px-12 cursor-pointer text-center inline-block rounded text-gray-600 hover:bg-gray-100 dark:hover:bg-dark-third dark:text-dark-txt">
                    <i class='bx bx-trophy'></i>
                </a>
            </li>
            <li class="w-1/5 md:w-max text-center">
                <a href="events.html"
                    class="w-full text-3xl py-2 px-3 xl:px-12 cursor-pointer text-center inline-block rounded text-gray-600 hover:bg-gray-100 dark:hover:bg-dark-third dark:text-dark-txt">
                    <i class='bx bx-calendar'></i>
                </a>
            </li>
            <li class="w-1/5 md:w-max text-center hidden md:inline-block">
                <a href="video.html"
                    class="w-full text-3xl py-2 px-3 xl:px-12 cursor-pointer text-center inline-block text-blue-500 border-b-4 border-blue-500">
                    <i class='bx bx-video'></i>
                </a>
            </li>
            <li class="w-1/5 md:w-max text-center inline-block md:hidden">
                <a href="#"
                    class="w-full text-3xl py-2 px-3 xl:px-12 cursor-pointer text-center inline-block rounded text-gray-600 hover:bg-gray-100 dark:hover:bg-dark-third dark:text-dark-txt">
                    <i class='bx bx-menu'></i>
                </a>
            </li>
        </ul>
        <!-- END MAIN NAV -->

        <!-- RIGHT NAV -->
        <ul class="hidden md:flex mx-4 items-center justify-center">
            <li>
                <button id="logout-btn"
                    class="text-xl grid place-items-center bg-gray-200 dark:bg-dark-third dark:text-dark-txt rounded-full mx-1 p-3 cursor-pointer hover:bg-gray-300 relative">
                    <i class='bx bx-log-out'></i>
                </button>
            </li>
            <li>
                <a href="messages.html" class="group relative">
                    <div
                        class="text-xl hidden xl:grid place-items-center bg-gray-200 dark:bg-dark-third dark:text-dark-txt rounded-full mx-1 p-3 cursor-pointer hover:bg-gray-300">
                        <i class='bx bx-message-rounded'></i>
                    </div>
                </a>
            </li>
            <li>
                <a href="notifications.html" class="group relative">
                    <div
                        class="text-xl grid place-items-center bg-gray-200 dark:bg-dark-third dark:text-dark-txt rounded-full mx-1 p-3 cursor-pointer hover:bg-gray-300 relative">
                        <i class='bx bxs-bell'></i>
                    </div>
                </a>
            </li>
            <li>
                <div class="text-xl grid place-items-center bg-gray-200 dark:bg-dark-third dark:text-dark-txt rounded-full mx-1 p-3 cursor-pointer hover:bg-gray-300 relative"
                    id="dark-mode-toggle">
                    <i class='bx bxs-moon'></i>
                </div>
            </li>
        </ul>
        <!-- END RIGHT NAV -->
    </nav>
    <!-- END NAV -->

    <!-- MAIN -->
    <div class="flex justify-center h-screen">
        <!-- LEFT MENU -->
        <div class="w-1/5 pt-16 h-full hidden xl:flex flex-col fixed top-0 left-0">
            <ul class="p-4">
                <li>
                    <a href="athlete_profile.html"
                        class="flex items-center space-x-2 p-2 hover:bg-gray-200 rounded-lg transition-all dark:text-dark-txt dark:hover:bg-dark-third">
                        <i class='bx bx-user-circle text-2xl'></i>
                        <span class="font-semibold">My Profile</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="flex items-center space-x-2 p-2 hover:bg-gray-200 rounded-lg transition-all dark:text-dark-txt dark:hover:bg-dark-third">
                        <i class='bx bx-group text-2xl'></i>
                        <span class="font-semibold">Connections</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="flex items-center space-x-2 p-2 hover:bg-gray-200 rounded-lg transition-all dark:text-dark-txt dark:hover:bg-dark-third">
                        <i class='bx bx-calendar-event text-2xl'></i>
                        <span class="font-semibold">Events</span>
                    </a>
                </li>
                <li>
                    <a href="#"
                        class="flex items-center space-x-2 p-2 hover:bg-gray-200 rounded-lg transition-all dark:text-dark-txt dark:hover:bg-dark-third">
                        <i class='bx bx-bar-chart-alt-2 text-2xl'></i>
                        <span class="font-semibold">Performance Stats</span>
                    </a>
                </li>
                <li>
                    <a href="video.html"
                        class="flex items-center space-x-2 p-2 hover:bg-gray-200 rounded-lg transition-all dark:text-dark-txt dark:hover:bg-dark-third">
                        <i class='bx bx-video text-2xl'></i>
                        <span class="font-semibold">Training Videos</span>
                    </a>
                </li>
                <li class="border-b border-gray-200 dark:border-dark-third mt-6"></li>
            </ul>
            <div class="mt-auto p-6 text-sm text-gray-500 dark:text-dark-txt">
                <a href="#">Privacy</a>
                <span>.</span>
                <a href="#">Terms</a>
                <span>.</span>
                <a href="#">Advertising</a>
                <span>.</span>
                <a href="#">Cookies</a>
                <span>.</span>
                <a href="#">Ad choices</a>
                <span>.</span>
                <a href="#">More</a>
                <span>.</span>
                <span>ScoutConnect Â© 2025</span>
            </div>
        </div>
        <!-- END LEFT MENU -->

        <!-- MAIN CONTENT -->
        <div class="w-full lg:w-2/3 xl:w-2/5 pt-32 lg:pt-16 px-2">
            <!-- NOTIFICATIONS HEADER -->
            <div class="px-4 mt-4 shadow rounded-lg bg-white dark:bg-dark-second">
                <div class="p-4 flex justify-between items-center border-b border-gray-200 dark:border-dark-third">
                    <h2 class="text-xl font-semibold dark:text-dark-txt">Notifications</h2>
                    <div class="flex space-x-2">
                        <div id="search-toggle"
                            class="w-8 h-8 grid place-items-center text-xl hover:bg-gray-200 dark:hover:bg-dark-third rounded-full cursor-pointer dark:text-dark-txt">
                            <i class='bx bx-search-alt-2'></i>
                        </div>
                        <div id="mark-all-read"
                            class="w-8 h-8 grid place-items-center text-xl hover:bg-gray-200 dark:hover:bg-dark-third rounded-full cursor-pointer dark:text-dark-txt">
                            <i class='bx bx-check-double'></i>
                        </div>
                        <div id="settings-toggle"
                            class="w-8 h-8 grid place-items-center text-xl hover:bg-gray-200 dark:hover:bg-dark-third rounded-full cursor-pointer dark:text-dark-txt">
                            <i class='bx bx-cog'></i>
                        </div>
                    </div>
                </div>
                <div class="p-2 flex border-b border-gray-200 dark:border-dark-third">
                    <div id="tab-all"
                        class="w-1/2 text-center py-2 font-semibold text-blue-500 border-b-2 border-blue-500 cursor-pointer">
                        All (<span id="all-count">0</span>)
                    </div>
                    <div id="tab-unread"
                        class="w-1/2 text-center py-2 font-semibold text-gray-500 dark:text-dark-txt cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-third">
                        Unread (<span id="unread-count">0</span>)
                    </div>
                </div>
            </div>

            <!-- LOADING INDICATOR -->
            <div id="loading" class="mt-4 text-center py-8 hidden">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="mt-2 text-gray-500 dark:text-dark-txt">Loading notifications...</p>
            </div>

            <!-- NOTIFICATION LIST -->
            <div id="notifications-list" class="mt-4 space-y-2">
                <!-- Notifications will be loaded here dynamically -->
            </div>

            <!-- EMPTY STATE -->
            <div id="empty-state" class="mt-8 text-center py-12 hidden">
                <i class='bx bx-bell text-6xl text-gray-300 dark:text-gray-600'></i>
                <h3 class="mt-4 text-lg font-semibold text-gray-500 dark:text-dark-txt">No notifications yet</h3>
                <p class="mt-2 text-gray-400">When you get notifications, they'll show up here.</p>
            </div>

            <!-- LOAD MORE BUTTON -->
            <div id="load-more-container" class="mt-4 text-center hidden">
                <button id="load-more-btn"
                    class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    Load More
                </button>
            </div>
        </div>
        <!-- END MAIN CONTENT -->

        <!-- RIGHT MENU -->
        <div class="w-1/5 pt-16 h-full hidden xl:block px-4 fixed top-0 right-0">
            <div class="h-full">
                <div class="flex justify-between items-center px-4 pt-4">
                    <span class="font-semibold text-gray-500 text-lg dark:text-dark-txt">Notification Filters</span>
                </div>
                <ul class="p-2" id="filter-list">
                    <li>
                        <div data-filter="all"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer bg-blue-100 dark:bg-blue-900">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-blue-100 grid place-items-center text-blue-500">
                                    <i class='bx bx-bell'></i>
                                </div>
                                <span>All Notifications</span>
                            </div>
                            <span id="filter-all-badge"
                                class="text-xs bg-blue-500 text-white px-2 py-1 rounded-full">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="message"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-blue-100 grid place-items-center text-blue-500">
                                    <i class='bx bx-envelope'></i>
                                </div>
                                <span>Messages</span>
                            </div>
                            <span id="filter-message-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="application"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-green-100 grid place-items-center text-green-500">
                                    <i class='bx bx-check'></i>
                                </div>
                                <span>Applications</span>
                            </div>
                            <span id="filter-application-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="scout_interest"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-yellow-100 grid place-items-center text-yellow-500">
                                    <i class='bx bx-star'></i>
                                </div>
                                <span>Scout Interest</span>
                            </div>
                            <span id="filter-scout_interest-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="event"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-purple-100 grid place-items-center text-purple-500">
                                    <i class='bx bx-calendar'></i>
                                </div>
                                <span>Events</span>
                            </div>
                            <span id="filter-event-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="reaction"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-red-100 grid place-items-center text-red-500">
                                    <i class='bx bx-like'></i>
                                </div>
                                <span>Reactions</span>
                            </div>
                            <span id="filter-reaction-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                    <li>
                        <div data-filter="connection"
                            class="filter-item flex items-center justify-between p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-blue-100 grid place-items-center text-blue-500">
                                    <i class='bx bx-user-plus'></i>
                                </div>
                                <span>Connections</span>
                            </div>
                            <span id="filter-connection-badge"
                                class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full hidden">0</span>
                        </div>
                    </li>
                </ul>
                <div class="border-b border-gray-200 dark:border-dark-third mt-6"></div>

                <div class="flex justify-between items-center px-4 pt-4">
                    <span class="font-semibold text-gray-500 text-lg dark:text-dark-txt">Quick Actions</span>
                </div>
                <ul class="p-2">
                    <li>
                        <div id="mark-all-read-action"
                            class="flex items-center space-x-2 p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="w-8 h-8 rounded-full bg-green-100 grid place-items-center text-green-500">
                                <i class='bx bx-check-double'></i>
                            </div>
                            <span>Mark All as Read</span>
                        </div>
                    </li>
                    <li>
                        <div id="clear-all-action"
                            class="flex items-center space-x-2 p-2 hover:bg-gray-200 dark:hover:bg-dark-third dark:text-dark-txt rounded-lg cursor-pointer">
                            <div class="w-8 h-8 rounded-full bg-red-100 grid place-items-center text-red-500">
                                <i class='bx bx-trash'></i>
                            </div>
                            <span>Clear All Read</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <!-- END RIGHT MENU -->
    </div>
    <!-- END MAIN -->

    <script>
        // Notifications functionality
        class NotificationsManager {
            constructor() {
                this.currentFilter = 'all';
                this.showUnreadOnly = false;
                this.currentPage = 1;
                this.hasMore = true;
                this.isLoading = false;
                this.notifications = [];

                this.init();
            }

            async init() {


                this.setupEventListeners();
                await this.loadNotifications();
                await this.loadNotificationCounts();

                // Refresh notifications every 30 seconds
                setInterval(() => {
                    this.loadNotificationCounts();
                    if (this.currentPage === 1) {
                        this.loadNotifications(true);
                    }
                }, 30000);
            }

            setupEventListeners() {
                // Tab switching
                document.getElementById('tab-all').addEventListener('click', () => {
                    this.showUnreadOnly = false;
                    this.switchTab('all');
                });

                document.getElementById('tab-unread').addEventListener('click', () => {
                    this.showUnreadOnly = true;
                    this.switchTab('unread');
                });

                // Filter items
                document.querySelectorAll('.filter-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const filter = item.dataset.filter;
                        this.setFilter(filter);
                    });
                });

                // Mark all as read
                document.getElementById('mark-all-read').addEventListener('click', () => {
                    this.markAllAsRead();
                });

                document.getElementById('mark-all-read-action').addEventListener('click', () => {
                    this.markAllAsRead();
                });

                // Load more
                document.getElementById('load-more-btn').addEventListener('click', () => {
                    this.loadMore();
                });

                // Logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    localStorage.removeItem('token');
                    window.location.href = '/frontend/login.html';
                });
            }

            switchTab(tab) {
                // Update tab styling
                document.getElementById('tab-all').className = tab === 'all'
                    ? 'w-1/2 text-center py-2 font-semibold text-blue-500 border-b-2 border-blue-500 cursor-pointer'
                    : 'w-1/2 text-center py-2 font-semibold text-gray-500 dark:text-dark-txt cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-third';

                document.getElementById('tab-unread').className = tab === 'unread'
                    ? 'w-1/2 text-center py-2 font-semibold text-blue-500 border-b-2 border-blue-500 cursor-pointer'
                    : 'w-1/2 text-center py-2 font-semibold text-gray-500 dark:text-dark-txt cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-third';

                this.currentPage = 1;
                this.notifications = [];
                this.loadNotifications();
            }

            setFilter(filter) {
                // Update filter styling
                document.querySelectorAll('.filter-item').forEach(item => {
                    item.classList.remove('bg-blue-100', 'dark:bg-blue-900');
                });

                const selectedFilter = document.querySelector(`[data-filter="${filter}"]`);
                selectedFilter.classList.add('bg-blue-100', 'dark:bg-blue-900');

                this.currentFilter = filter;
                this.currentPage = 1;
                this.notifications = [];
                this.loadNotifications();
            }

            async loadNotifications(refresh = false) {
                if (this.isLoading) return;

                this.isLoading = true;
                document.getElementById('loading').classList.remove('hidden');

                try {
                    const token = localStorage.getItem('token');
                    const params = new URLSearchParams({
                        page: refresh ? 1 : this.currentPage,
                        limit: 20,
                        unread_only: this.showUnreadOnly
                    });

                    if (this.currentFilter !== 'all') {
                        params.append('type', this.currentFilter);
                    }

                    const response = await fetch(`/api/notifications?${params}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) throw new Error('Failed to load notifications');

                    const data = await response.json();

                    if (refresh) {
                        this.notifications = data.notifications;
                        this.currentPage = 1;
                    } else {
                        this.notifications = [...this.notifications, ...data.notifications];
                    }

                    this.hasMore = data.pagination.hasMore;
                    this.renderNotifications();

                } catch (error) {
                    console.error('Error loading notifications:', error);
                    this.showError('Failed to load notifications');
                }

                this.isLoading = false;
                document.getElementById('loading').classList.add('hidden');
            }

            async loadNotificationCounts() {
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch('/api/notifications/counts', {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) throw new Error('Failed to load counts');

                    const data = await response.json();

                    // Update tab counts
                    document.getElementById('all-count').textContent = data.total.total;
                    document.getElementById('unread-count').textContent = data.total.unread;

                    // Update notification badge in nav
                    const badge = document.getElementById('notification-badge');
                    if (data.total.unread > 0) {
                        badge.textContent = data.total.unread;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }

                    // Update filter badges
                    Object.entries(data.byType).forEach(([type, counts]) => {
                        const badge = document.getElementById(`filter-${type}-badge`);
                        if (badge) {
                            if (counts.unread > 0) {
                                badge.textContent = counts.unread;
                                badge.classList.remove('hidden');
                                badge.className = 'text-xs bg-blue-500 text-white px-2 py-1 rounded-full';
                            } else {
                                badge.classList.add('hidden');
                            }
                        }
                    });

                    // Update "All" filter badge
                    const allBadge = document.getElementById('filter-all-badge');
                    if (data.total.unread > 0) {
                        allBadge.textContent = data.total.unread;
                        allBadge.className = 'text-xs bg-blue-500 text-white px-2 py-1 rounded-full';
                    } else {
                        allBadge.textContent = data.total.total;
                        allBadge.className = 'text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded-full';
                    }

                } catch (error) {
                    console.error('Error loading notification counts:', error);
                }
            }

            renderNotifications() {
                const container = document.getElementById('notifications-list');
                const emptyState = document.getElementById('empty-state');
                const loadMoreContainer = document.getElementById('load-more-container');

                if (this.notifications.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    loadMoreContainer.classList.add('hidden');
                    return;
                }

                emptyState.classList.add('hidden');

                container.innerHTML = this.notifications.map(notification => `
                    <div class="shadow bg-white dark:bg-dark-second dark:text-dark-txt rounded-lg notification-item" data-id="${notification.id}">
                        <div class="flex items-start space-x-4 p-4 hover:bg-gray-100 dark:hover:bg-dark-third cursor-pointer ${!notification.isRead ? 'bg-blue-50 dark:bg-blue-900' : ''}">
                            <div class="relative">
                                ${notification.relatedUser ? `<img src="${notification.relatedUser.profilePic}" alt="Profile picture" class="w-12 h-12 rounded-full">` : '<div class="w-12 h-12 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center"><i class="bx bx-bell text-gray-500"></i></div>'}
                                <div class="absolute -bottom-1 -right-1 ${notification.iconColor} text-white rounded-full p-1 text-xs">
                                    <i class='bx ${notification.icon}'></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <div class="notification-title font-semibold">${notification.title}</div>
                                    <span class="text-xs text-gray-500 dark:text-dark-txt">${notification.timestamp}</span>
                                </div>
                                ${notification.content ? `<p class="text-sm mt-1 text-gray-600 dark:text-dark-txt">${notification.content}</p>` : ''}
                                <div class="flex items-center justify-between mt-2">
                                    <span class="text-xs text-gray-400 capitalize">${notification.type.replace('_', ' ')}</span>
                                    <div class="flex space-x-2">
                                        ${!notification.isRead ? '<button class="mark-read-btn text-xs text-blue-500 hover:text-blue-700" data-id="' + notification.id + '">Mark as read</button>' : ''}
                                        <button class="delete-btn text-xs text-red-500 hover:text-red-700" data-id="${notification.id}">Delete</button>
                                    </div>
                                </div>
                            </div>
                            ${!notification.isRead ? '<div class="w-2 h-2 rounded-full bg-blue-500 mt-2"></div>' : ''}
                        </div>
                    </div>
                `).join('');

                // Add event listeners for actions
                container.querySelectorAll('.mark-read-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.markAsRead(parseInt(btn.dataset.id));
                    });
                });

                container.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteNotification(parseInt(btn.dataset.id));
                    });
                });

                // Show/hide load more button
                if (this.hasMore) {
                    loadMoreContainer.classList.remove('hidden');
                } else {
                    loadMoreContainer.classList.add('hidden');
                }
            }

            async markAsRead(notificationId) {
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch(`/api/notifications/${notificationId}/read`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) throw new Error('Failed to mark as read');

                    // Update local state
                    const notification = this.notifications.find(n => n.id === notificationId);
                    if (notification) {
                        notification.isRead = true;
                    }

                    this.renderNotifications();
                    this.loadNotificationCounts();

                } catch (error) {
                    console.error('Error marking notification as read:', error);
                    this.showError('Failed to mark notification as read');
                }
            }

            async markAllAsRead() {
                try {
                    const token = localStorage.getItem('token');
                    const body = {};

                    if (this.currentFilter !== 'all') {
                        body.type = this.currentFilter;
                    }

                    const response = await fetch('/api/notifications/mark-all-read', {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (!response.ok) throw new Error('Failed to mark all as read');

                    // Update local state
                    this.notifications.forEach(n => n.isRead = true);

                    this.renderNotifications();
                    this.loadNotificationCounts();

                } catch (error) {
                    console.error('Error marking all as read:', error);
                    this.showError('Failed to mark all notifications as read');
                }
            }

            async deleteNotification(notificationId) {
                if (!confirm('Are you sure you want to delete this notification?')) return;

                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch(`/api/notifications/${notificationId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) throw new Error('Failed to delete notification');

                    // Remove from local state
                    this.notifications = this.notifications.filter(n => n.id !== notificationId);

                    this.renderNotifications();
                    this.loadNotificationCounts();

                } catch (error) {
                    console.error('Error deleting notification:', error);
                    this.showError('Failed to delete notification');
                }
            }

            loadMore() {
                this.currentPage++;
                this.loadNotifications();
            }

            showError(message) {
                // You can implement a toast notification or alert here
                alert(message);
            }
        }

        // Initialize notifications manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new NotificationsManager();
        });
    </script>

    <script src="/frontend/script.js"></script>
</body>

</html>